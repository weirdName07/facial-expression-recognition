<main class="w-screen h-screen relative bg-dark-900 overflow-hidden font-sans">

   <!-- Header HUD -->
   <header class="absolute top-0 left-0 right-0 z-50 p-4 flex justify-between items-start pointer-events-none">
      <div class="flex items-center gap-3">
         <div
            class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-[0_0_20px_rgba(34,211,238,0.4)]">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" />
            </svg>
         </div>
         <div>
            <h1 class="text-lg font-bold tracking-tight text-white/90">Sentinel <span
                  class="text-cyan-400 text-xs font-mono tracking-widest pl-2">AI.HUB</span></h1>
            <div class="flex items-center gap-2 mt-0.5">
               <div class="w-1.5 h-1.5 rounded-full"
                  [ngClass]="isConnected ? 'bg-emerald-500 animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]' : 'bg-rose-500'">
               </div>
               <span class="text-[10px] font-mono text-white/60">{{ isConnected ? 'DATALINK SECURE' : 'CONNECTING...'
                  }}</span>
            </div>
         </div>
      </div>

      <div
         class="backdrop-blur-md bg-white/5 border border-white/10 rounded-lg p-2 px-4 shadow-lg flex items-center gap-4">
         <div class="flex flex-col text-right">
            <span class="text-[9px] text-white/50 tracking-widest uppercase">E2E Latency</span>
            <span class="text-xs font-mono text-white" [class.text-amber-400]="backendLatencyMs > 150">{{
               backendLatencyMs.toFixed(0) }} ms</span>
         </div>
         <div class="w-px h-6 bg-white/10"></div>
         <div class="flex flex-col text-right">
            <span class="text-[9px] text-white/50 tracking-widest uppercase">FPS</span>
            <span class="text-xs font-mono text-cyan-400">{{ fps > 0 ? fps.toFixed(1) : '--' }}</span>
         </div>
      </div>
   </header>

   <!-- Fullscreen Camera -->
   <app-camera-stream class="absolute inset-0 w-full h-full" [frameBase64]="currentFrame"></app-camera-stream>

   <!-- Annotation Overlay -->
   <div class="absolute inset-0 pointer-events-none overflow-hidden" style="transform: scaleX(-1);">
      <ng-container *ngFor="let id of objectKeys(faces)">
         <app-face-card [faceId]="id" [x]="faces[id].bbox.x_min * viewportWidth"
            [y]="faces[id].bbox.y_min * viewportHeight"
            [width]="(faces[id].bbox.x_max - faces[id].bbox.x_min) * viewportWidth"
            [height]="(faces[id].bbox.y_max - faces[id].bbox.y_min) * viewportHeight"
            [confidence]="faces[id].tracking_confidence" [emotion]="faces[id].expression?.dominant_emotion"
            [emotionConfidence]="faces[id].expression?.confidence" [probabilities]="faces[id].expression?.probabilities"
            [rppg]="faces[id].rppg" [screenWidth]="viewportWidth">
         </app-face-card>
      </ng-container>
   </div>

   <!-- Vignette -->
   <div class="absolute inset-0 pointer-events-none"
      style="background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.35) 100%);"></div>

   <!-- Permission Overlay -->
   <div *ngIf="!cameraStarted"
      class="absolute inset-0 z-[100] backdrop-blur-2xl flex items-center justify-center transition-all duration-700"
      style="background: radial-gradient(circle at center, rgba(30, 25, 20, 0.6) 0%, rgba(10, 8, 5, 0.95) 100%);">

      <div
         class="max-w-md w-full p-8 rounded-3xl text-center border border-amber-400/10 shadow-[0_0_50px_rgba(0,0,0,0.5)]"
         style="background: rgba(30, 25, 20, 0.6);">

         <div
            class="w-20 h-20 rounded-full bg-gradient-to-br from-amber-400 to-orange-600 mx-auto flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(251,191,36,0.2)] animate-pulse">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
         </div>

         <h2 class="text-2xl font-bold text-white mb-2 tracking-tight">Sentinel Neural Link</h2>
         <p class="text-white/60 text-sm mb-8 leading-relaxed">
            Initialize biometric analytics and emotion recognition. <br>
            Please grant camera access to begin real-time detection.
         </p>

         <button (click)="startSession()"
            class="w-full py-4 rounded-xl bg-amber-500 hover:bg-amber-400 text-black font-bold tracking-widest uppercase text-xs transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-[0_0_20px_rgba(245,158,11,0.3)]">
            Initialize Neural Link
         </button>

         <div class="mt-6 flex items-center justify-center gap-4 opacity-40">
            <span class="text-[9px] font-mono text-white tracking-widest uppercase">Privacy Mode Active</span>
            <div class="w-1 h-1 rounded-full bg-white"></div>
            <span class="text-[9px] font-mono text-white tracking-widest uppercase">Local Inference</span>
         </div>
      </div>
   </div>

</main>